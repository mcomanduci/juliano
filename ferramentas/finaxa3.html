<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2793888277943433"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div
      id="calculadoraISO"
      style="
        max-width: 500px;
        margin: auto;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        font-family: 'Inter', Arial, sans-serif;
      "
    >
      <h1 style="text-align: center; color: #222">
        üí∞ Calculadora ISO Avan√ßada
      </h1>
      <p
        style="
          text-align: center;
          color: #555;
          font-size: 14px;
          margin-bottom: 20px;
        "
      >
        Calcule seu ganho potencial com op√ß√µes de a√ß√µes de forma detalhada.
      </p>

      <label>Pre√ßo de Exerc√≠cio (por a√ß√£o):</label>
      <input
        id="precoExercicio"
        type="number"
        step="0.01"
        placeholder="Ex: 10.00"
        style="
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 8px;
          border: 1px solid #ccc;
        "
      />

      <label>Pre√ßo Atual da A√ß√£o:</label>
      <input
        id="precoAtual"
        type="number"
        step="0.01"
        placeholder="Ex: 50.00"
        style="
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 8px;
          border: 1px solid #ccc;
        "
      />

      <label>N√∫mero de A√ß√µes:</label>
      <input
        id="acoes"
        type="number"
        placeholder="Ex: 100"
        style="
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 8px;
          border: 1px solid #ccc;
        "
      />

      <label>Al√≠quota de Imposto (%):</label>
      <input
        id="imposto"
        type="number"
        step="0.01"
        placeholder="Ex: 15"
        style="
          width: 100%;
          padding: 10px;
          margin-bottom: 10px;
          border-radius: 8px;
          border: 1px solid #ccc;
        "
      />

      <label>Moeda:</label>
      <select
        id="moeda"
        style="
          width: 100%;
          padding: 10px;
          margin-bottom: 20px;
          border-radius: 8px;
          border: 1px solid #ccc;
        "
      >
        <option value="auto">üåç Detectar automaticamente</option>
        <option value="USD">üá∫üá∏ D√≥lar (USD)</option>
        <option value="EUR">üá™üá∫ Euro (EUR)</option>
        <option value="BRL">üáßüá∑ Real (BRL)</option>
        <option value="GBP">üá¨üáß Libra (GBP)</option>
        <option value="JPY">üáØüáµ Iene (JPY)</option>
        <option value="CAD">üá®üá¶ D√≥lar Canadense (CAD)</option>
        <option value="AUD">üá¶üá∫ D√≥lar Australiano (AUD)</option>
      </select>

      <button
        onclick="calcularISO()"
        style="
          width: 100%;
          background: #007bff;
          color: white;
          padding: 12px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
        "
      >
        Calcular
      </button>

      <h3
        id="resultado"
        style="text-align: center; margin-top: 20px; color: #111"
      ></h3>

      <canvas
        id="graficoISO"
        width="600"
        height="260"
        style="max-width: 100%; height: auto; margin-top: 20px"
      ></canvas>

      <h4 style="margin-top: 20px">üìú Hist√≥rico (√∫ltimas 5 simula√ß√µes)</h4>
      <ul id="historico" style="list-style: none; padding-left: 0"></ul>

      <p
        style="
          text-align: center;
          margin-top: 15px;
          font-size: 13px;
          color: #777;
        "
      >
        üîó Quer transformar esses c√°lculos em relat√≥rios autom√°ticos?
        <a
          href="https://finaxa.me"
          target="_blank"
          style="color: #007bff; text-decoration: none; font-weight: 600"
          >Acesse Finaxa.me</a
        >
      </p>
    </div>

    <!-- =========================================================
     SCRIPT DE C√ÅLCULO
========================================================= -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      let historico = [];
      let chart;

      async function detectarMoeda() {
        try {
          const res = await fetch("https://ipapi.co/json/");
          const data = await res.json();
          const mapa = {
            BR: "BRL",
            US: "USD",
            GB: "GBP",
            EU: "EUR",
            JP: "JPY",
            CA: "CAD",
            AU: "AUD",
          };
          return mapa[data.country_code] || "USD";
        } catch {
          return "USD";
        }
      }

      async function calcularISO() {
        const precoExercicio = parseFloat(
          document.getElementById("precoExercicio").value
        );
        const precoAtual = parseFloat(
          document.getElementById("precoAtual").value
        );
        const acoes = parseFloat(document.getElementById("acoes").value);
        const imposto = parseFloat(
          document.getElementById("imposto").value || 0
        );
        let moeda = document.getElementById("moeda").value;

        if (moeda === "auto") moeda = await detectarMoeda();
        if (isNaN(precoExercicio) || isNaN(precoAtual) || isNaN(acoes)) {
          document.getElementById("resultado").innerHTML =
            "‚ö†Ô∏è Preencha todos os campos corretamente.";
          return;
        }

        const ganhoBruto = (precoAtual - precoExercicio) * acoes;
        const ganhoLiquido = ganhoBruto * (1 - imposto / 100);
        const formatador = new Intl.NumberFormat(undefined, {
          style: "currency",
          currency: moeda,
        });

        document.getElementById(
          "resultado"
        ).innerHTML = `üíµ Ganho Bruto: <strong>${formatador.format(
          ganhoBruto
        )}</strong><br>
     üí∏ Ganho L√≠quido: <strong>${formatador.format(ganhoLiquido)}</strong>`;

        historico.unshift({ bruto: ganhoBruto, liquido: ganhoLiquido, moeda });
        if (historico.length > 5) historico.pop();
        const ul = document.getElementById("historico");
        ul.innerHTML = "";
        historico.forEach((item, i) => {
          ul.innerHTML += `<li>Simula√ß√£o ${i + 1}: ${formatador.format(
            item.bruto
          )} ‚Üí ${formatador.format(item.liquido)}</li>`;
        });

        const labels = [],
          dataPoints = [];
        for (let i = 0; i <= 10; i++) {
          labels.push(`+${i * 10}%`);
          dataPoints.push(ganhoBruto * (1 + i / 10));
        }

        if (chart) chart.destroy();
        const canvas = document.getElementById("graficoISO");
        if (!canvas) {
          console.error("Canvas #graficoISO n√£o encontrado");
          document.getElementById("resultado").innerHTML +=
            "<br>‚ö†Ô∏è Erro: elemento de gr√°fico n√£o encontrado.";
          return;
        }
        const ctx = canvas.getContext("2d");
        if (!ctx) {
          console.error("Context2D n√£o dispon√≠vel no canvas");
          document.getElementById("resultado").innerHTML +=
            "<br>‚ö†Ô∏è Erro ao obter contexto do canvas.";
          return;
        }
        try {
          chart = new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "Ganho Bruto Potencial",
                data: dataPoints,
                borderColor: "#007bff",
                fill: true,
                backgroundColor: "rgba(0,123,255,0.1)",
                tension: 0.3,
              },
            ],
          },
          options: {
            responsive: true,
            // Usamos maintainAspectRatio:true com aspectRatio baseado nos atributos
            // do canvas para evitar altura zero em alguns navegadores/containers.
            maintainAspectRatio: true,
            aspectRatio: 600 / 260,
            plugins: { legend: { display: true } },
          },
          });
        } catch (e) {
          console.error("Erro ao criar o gr√°fico:", e);
          document.getElementById("resultado").innerHTML +=
            "<br>‚ö†Ô∏è Erro ao desenhar o gr√°fico. Abra o console para mais detalhes.";
        }
      }
    </script>

    <!-- =========================================================
     GUIA DE USO DA CALCULADORA
========================================================= -->
    <div
      style="
        max-width: 500px;
        margin: auto;
        padding: 20px;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        font-family: 'Inter', Arial, sans-serif;
      "
    >
      <h2 style="text-align: center; color: #222">
        üìò Guia de Uso - Calculadora ISO
      </h2>

      <h3 style="color: #007bff">1. O que √© ISO?</h3>
      <p style="color: #555; font-size: 14px; line-height: 1.5">
        ISO significa <strong>Incentive Stock Option</strong> ‚Äî uma op√ß√£o de
        a√ß√µes concedida a funcion√°rios para comprar a√ß√µes a um
        <strong>pre√ßo fixo</strong>, mesmo que o valor de mercado suba.
      </p>

      <h3 style="color: #007bff">2. O que √© o pre√ßo de exerc√≠cio?</h3>
      <p style="color: #555; font-size: 14px; line-height: 1.5">
        √â o valor pago por a√ß√£o ao exercer a op√ß√£o. Ex: se o pre√ßo de exerc√≠cio
        for <strong>US$10</strong> e a a√ß√£o estiver a <strong>US$50</strong>, o
        ganho √© <strong>US$40</strong> por a√ß√£o.
      </p>

      <h3 style="color: #007bff">3. Como usar</h3>
      <ol
        style="
          color: #555;
          font-size: 14px;
          line-height: 1.5;
          padding-left: 20px;
        "
      >
        <li>Insira o <strong>pre√ßo de exerc√≠cio</strong> por a√ß√£o.</li>
        <li>Insira o <strong>pre√ßo atual</strong> da a√ß√£o.</li>
        <li>Informe o <strong>n√∫mero de a√ß√µes</strong>.</li>
        <li>Opcional: adicione a <strong>al√≠quota de imposto</strong>.</li>
        <li>Escolha a moeda ou use a <strong>detec√ß√£o autom√°tica</strong>.</li>
        <li>Clique em <strong>Calcular</strong>.</li>
      </ol>

      <h3 style="color: #007bff">4. Funcionalidades avan√ßadas</h3>
      <ul
        style="
          color: #555;
          font-size: 14px;
          line-height: 1.5;
          padding-left: 20px;
        "
      >
        <li>üìä Gr√°fico de crescimento do lucro por valoriza√ß√£o.</li>
        <li>üìù Hist√≥rico das √∫ltimas 5 simula√ß√µes.</li>
        <li>üí∞ C√°lculo autom√°tico de ganho l√≠quido.</li>
        <li>üåç Detec√ß√£o autom√°tica de moeda.</li>
        <li>üîó Integra√ß√£o com Finaxa.me.</li>
      </ul>

      <h3 style="color: #007bff">5. Dicas pr√°ticas</h3>
      <p style="color: #555; font-size: 14px; line-height: 1.5">
        - Verifique sempre a al√≠quota de imposto local.<br />
        - Compare diferentes cen√°rios no hist√≥rico.<br />
        - Use o gr√°fico para simular valoriza√ß√£o da a√ß√£o.<br />
        - Para relat√≥rios autom√°ticos, visite
        <a
          href="https://finaxa.me"
          target="_blank"
          style="color: #007bff; text-decoration: none; font-weight: 600"
          >Finaxa.me</a
        >.
      </p>
    </div>
  </body>
</html>
