<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cripto Central Finaxa Lite</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --cor-primaria: #007bff; /* Azul vibrante */
        --cor-secundaria: #6c757d; /* Cinza m√©dio */
        --cor-fundo: #f4f7f6; /* Fundo claro */
        --cor-card: #ffffff; /* Fundo dos cards */
        --cor-texto: #333333; /* Texto principal */
        --cor-borda: #e9ecef; /* Bordas e divisores */
        --cor-sucesso: #28a745; /* Verde para positivo */
        --cor-erro: #dc3545; /* Vermelho para negativo */
        --cor-aviso: #ffc107; /* Amarelo para aviso */
        --sombra-leve: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transicao-suave: all 0.3s ease;
      }

      /* Dark Mode */
      body.dark-mode {
        --cor-fundo: #2c2c2c;
        --cor-card: #3a3a3a;
        --cor-texto: #e0e0e0;
        --cor-borda: #4f4f4f;
        --cor-secundaria: #a0a0a0;
      }

      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--cor-fundo);
        color: var(--cor-texto);
        line-height: 1.6;
        transition: background-color var(--transicao-suave),
          color var(--transicao-suave);
      }

      header {
        background: linear-gradient(to right, var(--cor-primaria), #0056b3);
        color: white;
        padding: 20px 0;
        text-align: center;
        box-shadow: var(--sombra-leve);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      header h1 {
        margin: 0;
        font-size: 2.2em;
        font-weight: 700;
      }

      header p {
        margin: 5px 0 15px;
        font-size: 1.1em;
        opacity: 0.9;
      }

      nav {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      nav button {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 600;
        transition: background-color var(--transicao-suave), transform 0.2s ease;
      }

      nav button:hover {
        background-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      nav button.active {
        background-color: white;
        color: var(--cor-primaria);
        box-shadow: var(--sombra-leve);
        transform: translateY(-2px);
      }

      .container {
        max-width: 1200px;
        margin: 25px auto;
        padding: 0 20px;
      }

      .section {
        background-color: var(--cor-card);
        padding: 30px;
        margin-bottom: 25px;
        border-radius: 12px;
        box-shadow: var(--sombra-leve);
        display: none; /* Esconde todas as se√ß√µes por padr√£o */
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease-out, transform 0.5s ease-out;
      }

      .section.active {
        display: block; /* Mostra a se√ß√£o ativa */
        opacity: 1;
        transform: translateY(0);
      }

      h2 {
        color: var(--cor-primaria);
        margin-top: 0;
        font-size: 1.8em;
        border-bottom: 2px solid var(--cor-borda);
        padding-bottom: 15px;
        margin-bottom: 25px;
      }

      .form-group {
        margin-bottom: 18px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--cor-texto);
      }

      .form-group input[type="text"],
      .form-group input[type="number"],
      .form-group input[type="date"],
      .form-group select {
        width: calc(100% - 20px);
        padding: 12px;
        border: 1px solid var(--cor-borda);
        border-radius: 8px;
        font-size: 1em;
        background-color: var(--cor-fundo);
        color: var(--cor-texto);
        transition: border-color var(--transicao-suave);
      }

      .form-group input[type="text"]:focus,
      .form-group input[type="number"]:focus,
      .form-group input[type="date"]:focus,
      .form-group select:focus {
        border-color: var(--cor-primaria);
        outline: none;
      }

      button {
        background-color: var(--cor-primaria);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: background-color var(--transicao-suave), transform 0.2s ease;
        margin-top: 10px;
      }

      button:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
      }

      .message {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 500;
        display: none;
      }

      .message.info {
        background-color: #e0f2f7;
        color: #0056b3;
        border: 1px solid #a7d9ed;
      }

      .message.success {
        background-color: #d4edda;
        color: var(--cor-sucesso);
        border: 1px solid #c3e6cb;
      }

      .message.error {
        background-color: #f8d7da;
        color: var(--cor-erro);
        border: 1px solid #f5c6cb;
      }

      .message.warning {
        background-color: #fff3cd;
        color: var(--cor-aviso);
        border: 1px solid #ffeeba;
      }

      /* Dashboard Grid */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .dashboard-card {
        background-color: var(--cor-fundo);
        padding: 20px;
        border-radius: 10px;
        box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        border: 1px solid var(--cor-borda);
        transition: all 0.3s ease;
      }

      .dashboard-card:hover {
        box-shadow: var(--sombra-leve);
        transform: translateY(-3px);
      }

      .dashboard-card img {
        width: 50px;
        height: 50px;
        margin-bottom: 10px;
      }

      .dashboard-card h3 {
        margin: 5px 0;
        font-size: 1.3em;
        color: var(--cor-texto);
      }

      .dashboard-card p {
        font-size: 1.1em;
        font-weight: 700;
        margin: 5px 0;
      }

      .dashboard-card .change {
        font-weight: 600;
        font-size: 0.9em;
        margin-bottom: 10px;
      }

      .dashboard-card .change.positive {
        color: var(--cor-sucesso);
      }

      .dashboard-card .change.negative {
        color: var(--cor-erro);
      }

      .sparkline-canvas {
        width: 100% !important;
        height: 70px !important;
        margin-top: 10px;
      }

      .volatility-thermometer {
        text-align: center;
        margin-top: 30px;
        padding: 15px;
        border-radius: 10px;
        font-size: 1.1em;
        font-weight: 600;
        background-color: #e0f7fa; /* Light blue default */
        color: #007bff;
        border: 1px solid #b2ebf2;
        transition: all 0.5s ease;
      }

      .volatility-thermometer.low {
        background-color: #d4edda;
        color: var(--cor-sucesso);
        border-color: #c3e6cb;
      }

      .volatility-thermometer.medium {
        background-color: #fff3cd;
        color: var(--cor-aviso);
        border-color: #ffeeba;
      }

      .volatility-thermometer.high {
        background-color: #f8d7da;
        color: var(--cor-erro);
        border-color: #f5c6cb;
      }

      /* Crypto Table */
      #cryptoTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      #cryptoTable th,
      #cryptoTable td {
        text-align: left;
        padding: 12px 10px;
        border-bottom: 1px solid var(--cor-borda);
      }

      #cryptoTable th {
        background-color: var(--cor-fundo);
        font-weight: 600;
        color: var(--cor-secundaria);
        position: sticky;
        top: 0;
        z-index: 1;
      }

      #cryptoTable tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
      }

      #cryptoTable td img {
        vertical-align: middle;
        margin-right: 8px;
      }

      #cryptoTable .positive {
        color: var(--cor-sucesso);
        font-weight: 600;
      }

      #cryptoTable .negative {
        color: var(--cor-erro);
        font-weight: 600;
      }

      /* Sentimento */
      .sentiment-btn {
        background-color: var(--cor-secundaria);
        margin: 5px;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 500;
      }

      .sentiment-btn[data-sentiment="optimistic"] {
        background-color: var(--cor-sucesso);
      }
      .sentiment-btn[data-sentiment="neutral"] {
        background-color: #6c757d;
      }
      .sentiment-btn[data-sentiment="pessimistic"] {
        background-color: var(--cor-erro);
      }

      .sentiment-btn:hover {
        opacity: 0.9;
        transform: scale(1.02);
      }

      /* Education */
      #cryptoGlossary {
        margin-top: 20px;
      }

      .news-item {
        background-color: var(--cor-fundo);
        padding: 18px;
        border-radius: 10px;
        margin-bottom: 15px;
        border: 1px solid var(--cor-borda);
        transition: box-shadow var(--transicao-suave);
      }

      .news-item:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
      }

      .news-item h3 {
        color: var(--cor-primaria);
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 1.4em;
      }

      .news-item p {
        margin: 0;
        color: var(--cor-texto);
      }

      /* Quiz */
      #quizQuestion {
        background-color: var(--cor-fundo);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        border: 1px solid var(--cor-borda);
      }

      #quizQuestion p.question-text {
        font-size: 1.1em;
        margin-bottom: 15px;
        font-weight: 600;
      }

      .quiz-option-btn {
        display: block;
        width: 100%;
        text-align: left;
        margin-bottom: 10px;
        background-color: var(--cor-card);
        color: var(--cor-texto);
        border: 1px solid var(--cor-borda);
        padding: 12px 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .quiz-option-btn:hover {
        background-color: rgba(0, 123, 255, 0.1);
        border-color: var(--cor-primaria);
      }

      .quiz-option-btn.correct {
        background-color: var(--cor-sucesso);
        color: white;
        border-color: var(--cor-sucesso);
      }

      .quiz-option-btn.incorrect {
        background-color: var(--cor-erro);
        color: white;
        border-color: var(--cor-erro);
      }

      /* Dark Mode Toggle */
      #darkModeToggle {
        position: absolute;
        top: 25px;
        right: 20px;
        background: none;
        border: none;
        font-size: 2em;
        cursor: pointer;
        color: white;
        transition: transform 0.2s ease;
      }

      #darkModeToggle:hover {
        transform: scale(1.1);
      }

      /* Responsividade */
      @media (max-width: 768px) {
        header h1 {
          font-size: 1.8em;
        }
        nav {
          flex-direction: column;
          align-items: center;
        }
        nav button {
          width: 80%;
          max-width: 250px;
        }
        .section {
          padding: 20px;
        }
        .dashboard-grid {
          grid-template-columns: 1fr;
        }
        #cryptoTable th,
        #cryptoTable td {
          padding: 8px 5px;
          font-size: 0.9em;
        }
        #cryptoTable td:nth-child(5) {
          /* Hide chart on small screens */
          display: none;
        }
        #cryptoTable th:nth-child(5) {
          display: none;
        }
        #darkModeToggle {
          top: 15px;
          right: 15px;
          font-size: 1.5em;
        }
      }
    </style>
  </head>
  <body>
    <button id="darkModeToggle">
      <span id="darkModeIcon">‚òÄÔ∏è</span>
    </button>
    <header>
      <h1>Cripto Central Finaxa Lite</h1>
      <p>Seu Hub Essencial de Criptomoedas</p>
      <nav>
        <button data-section="dashboard" class="active">
          Dashboard Essencial
        </button>
        <button data-section="realtime">Pre√ßos e Ranking</button>
        <button data-section="simulator">Simulador "E Se..."</button>
        <button data-section="converter">Conversor Inteligente</button>
        <button data-section="sentiment">An√°lise de Sentimento</button>
        <button data-section="education">Minuto Cripto</button>
      </nav>
    </header>

    <div class="container">
      <section id="dashboard" class="section active">
        <h2>Dashboard Essencial</h2>
        <p
          class="message info"
          id="dashboardLoadingMessage"
          style="display: block"
        >
          Carregando os principais dados do mercado...
        </p>
        <div class="dashboard-grid" id="top5Dashboard"></div>
        <div class="volatility-thermometer" id="volatilityThermo">
          üå°Ô∏è Volatilidade do Mercado:
          <span id="volatilityLevel">Calculando...</span>
        </div>
      </section>

      <section id="realtime" class="section">
        <h2>Pre√ßos em Tempo Real e Ranking</h2>
        <div class="form-group">
          <input
            type="text"
            id="cryptoSearch"
            placeholder="Buscar criptomoeda..."
          />
        </div>
        <p class="message info" id="realtimeLoadingMessage">
          Carregando dados... Atualizando a cada minuto.
        </p>
        <table id="cryptoTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Nome</th>
              <th>Pre√ßo</th>
              <th>Var. 24h</th>
              <th>Gr√°fico (24h)</th>
              <th>Cap. Mercado</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="simulator" class="section">
        <h2>Simulador "E Se Eu Tivesse Investido..."</h2>
        <p>
          Descubra o resultado de investimentos hipot√©ticos nas principais
          criptomoedas.
        </p>
        <div class="form-group">
          <label for="simScenario">Escolha um cen√°rio:</label>
          <select id="simScenario">
            <option value="">-- Selecione um cen√°rio --</option>
            <option value="btc-1y-500">R$ 500 em Bitcoin h√° 1 ano</option>
            <option value="eth-6m-1000">R$ 1.000 em Ethereum h√° 6 meses</option>
            <option value="btc-3m-200">R$ 200 em Bitcoin h√° 3 meses</option>
            <option value="eth-1m-750">R$ 750 em Ethereum h√° 1 m√™s</option>
            <option value="custom">Outro cen√°rio (personalizado)</option>
          </select>
        </div>
        <div id="customScenarioFields" style="display: none">
          <div class="form-group">
            <label for="simCryptoCustom">Criptomoeda:</label>
            <select id="simCryptoCustom">
              <option value="bitcoin">Bitcoin (BTC)</option>
              <option value="ethereum">Ethereum (ETH)</option>
              <option value="binancecoin">Binance Coin (BNB)</option>
              <option value="solana">Solana (SOL)</option>
              <option value="ripple">XRP (Ripple)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="investedAmountCustom">Valor Investido (BRL):</label>
            <input
              type="number"
              id="investedAmountCustom"
              value="1000"
              min="1"
              step="any"
            />
          </div>
          <div class="form-group">
            <label for="startDateCustom">Data Inicial:</label>
            <input type="date" id="startDateCustom" />
          </div>
        </div>
        <button id="calculateProfitBtn">Calcular Resultado</button>
        <p class="message error" id="simulatorErrorMessage"></p>
        <div id="simulatorResult" style="margin-top: 20px; display: none">
          <h3>Seu Investimento...</h3>
          <p>Valor Inicial: R$<span id="initialValueDisplay"></span></p>
          <p>Valor Atual: R$<span id="currentValueDisplay"></span></p>
          <p>Resultado: <span id="profitLossDisplay"></span></p>
          <p>Percentual: <span id="percentDisplay"></span></p>
        </div>
      </section>

      <section id="converter" class="section">
        <h2>Conversor Inteligente</h2>
        <div class="form-group">
          <label for="convertAmount">Converter Quantia:</label>
          <input
            type="number"
            id="convertAmount"
            value="1"
            min="0.000001"
            step="any"
          />
        </div>
        <div class="form-group">
          <label for="fromCurrency">De:</label>
          <select id="fromCurrency">
            <option value="btc">Bitcoin (BTC)</option>
            <option value="eth">Ethereum (ETH)</option>
            <option value="usd">D√≥lar Americano (USD)</option>
            <option value="brl">Real Brasileiro (BRL)</option>
            <option value="eur">Euro (EUR)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="toCurrency">Para:</label>
          <select id="toCurrency">
            <option value="brl">Real Brasileiro (BRL)</option>
            <option value="usd">D√≥lar Americano (USD)</option>
            <option value="btc">Bitcoin (BTC)</option>
            <option value="eth">Ethereum (ETH)</option>
            <option value="eur">Euro (EUR)</option>
          </select>
        </div>
        <button id="convertBtn">Converter</button>
        <p class="message error" id="converterErrorMessage"></p>
        <p
          id="convertResult"
          style="margin-top: 20px; font-size: 1.2em; font-weight: bold"
        >
          Resultado: --
        </p>
        <div style="margin-top: 25px">
          <h3>Quanto Vale um Caf√©? ‚òï</h3>
          <p id="coffeeValueMessage" class="message info">Calculando...</p>
        </div>
      </section>

      <section id="sentiment" class="section">
        <h2>An√°lise R√°pida de Sentimento de Mercado</h2>
        <p>Tenha uma ideia r√°pida do "clima" geral do mercado cripto.</p>

        <div style="text-align: center; margin-bottom: 30px">
          <h3>√çndice de Sentimento Finaxa</h3>
          <p
            id="sentimentGauge"
            style="font-size: 3em; font-weight: bold; margin: 10px 0"
          >
            --
          </p>
          <p
            id="sentimentDescription"
            style="font-size: 1.1em; color: var(--cor-secundaria)"
          >
            Calculando o humor do mercado...
          </p>
        </div>

        <div class="message warning" style="display: block">
          <p>
            <strong>Isen√ß√£o de Responsabilidade:</strong> Este √≠ndice √© uma
            estimativa baseada em dados de varia√ß√£o de pre√ßo simplificados e n√£o
            reflete an√°lises de sentimento complexas ou profissionais. Use-o
            apenas como um guia r√°pido.
          </p>
        </div>

        <h3 style="margin-top: 40px">
          Voc√™ est√° Otimista ou Pessimista? (Mini-Pesquisa)
        </h3>
        <div id="userSentimentSurvey">
          <p>Como voc√™ se sente em rela√ß√£o ao mercado cripto hoje?</p>
          <button class="sentiment-btn" data-sentiment="optimistic">
            üöÄ Muito Otimista (Alta!)
          </button>
          <button class="sentiment-btn" data-sentiment="neutral">
            ü§î Neutro (Cautela)
          </button>
          <button class="sentiment-btn" data-sentiment="pessimistic">
            üìâ Pessimista (Queda!)
          </button>
          <p
            id="surveyFeedback"
            class="message info"
            style="margin-top: 15px"
          ></p>
        </div>
      </section>

      <section id="education" class="section">
        <h2>Minuto Cripto: P√≠lulas de Conhecimento</h2>
        <p>Conceitos r√°pidos e essenciais para entender o universo cripto.</p>

        <div class="form-group">
          <label for="glossarySearch">Buscar no Gloss√°rio:</label>
          <input
            type="text"
            id="glossarySearch"
            placeholder="Ex: Blockchain, NFT..."
          />
        </div>

        <div id="cryptoGlossary">
          <div class="news-item">
            <h3>Blockchain</h3>
            <p>
              Uma tecnologia de registro distribu√≠do e descentralizado que
              garante a seguran√ßa e imutabilidade das transa√ß√µes de
              criptomoedas.
            </p>
          </div>
          <div class="news-item">
            <h3>Bitcoin (BTC)</h3>
            <p>
              A primeira e mais famosa criptomoeda, criada para ser um sistema
              de dinheiro eletr√¥nico peer-to-peer descentralizado.
            </p>
          </div>
          <div class="news-item">
            <h3>Ethereum (ETH)</h3>
            <p>
              Uma plataforma descentralizada que permite a cria√ß√£o e execu√ß√£o de
              contratos inteligentes e aplicativos descentralizados (dApps).
            </p>
          </div>
          <div class="news-item">
            <h3>Altcoin</h3>
            <p>
              Qualquer criptomoeda que n√£o seja o Bitcoin. O termo "altcoin"
              significa "alternative coin" (moeda alternativa).
            </p>
          </div>
          <div class="news-item">
            <h3>Smart Contract (Contrato Inteligente)</h3>
            <p>
              Contratos autoexecut√°veis com os termos do acordo escritos
              diretamente em c√≥digo. Eles rodam em uma blockchain e s√£o
              imut√°veis.
            </p>
          </div>
          <div class="news-item">
            <h3>NFT (Token N√£o Fung√≠vel)</h3>
            <p>
              Um tipo de token criptogr√°fico que representa um ativo digital
              √∫nico e insubstitu√≠vel, como arte, m√∫sica ou itens de jogos.
            </p>
          </div>
          <div class="news-item">
            <h3>Halving</h3>
            <p>
              Um evento programado no Bitcoin (e algumas outras criptos) que
              reduz pela metade a recompensa que os mineradores recebem,
              impactando a oferta e escassez da moeda.
            </p>
          </div>
        </div>

        <h3 style="margin-top: 30px">Quiz: Qual o seu Perfil Cripto? üöÄ</h3>
        <div id="quizContainer">
          <p>Responda r√°pido para ter uma ideia do seu perfil!</p>
          <div id="quizQuestion" style="display: none">
            <p><strong>Quest√£o 1 de 3:</strong></p>
            <p class="question-text"></p>
            <button class="quiz-option-btn"></button><br />
            <button class="quiz-option-btn"></button><br />
            <button class="quiz-option-btn"></button>
          </div>
          <button id="startQuizBtn">Iniciar Quiz R√°pido</button>
          <p id="quizResult" class="message info" style="margin-top: 15px"></p>
        </div>
        <p class="message info" style="margin-top: 25px">
          Conte√∫do educativo completo e quizzes mais avan√ßados dispon√≠veis na
          vers√£o "Cripto Central Finaxa PRO"!
        </p>
      </section>

      <section
        class="section"
        style="
          display: block;
          text-align: center;
          background: none;
          box-shadow: none;
          margin-bottom: 50px;
        "
      >
        <p style="margin-top: 30px">
          Tem d√∫vidas?
          <a
            href="mailto:contato@finaxa.me"
            style="
              color: var(--cor-primaria);
              text-decoration: none;
              font-weight: bold;
            "
            >Fale com a Finaxa!</a
          >
        </p>
      </section>
    </div>

    <script>
      // JavaScript principal para as funcionalidades da p√°gina

      const COINGECKO_API_URL = "https://api.coingecko.com/api/v3";

      const sections = document.querySelectorAll(".section");
      const navButtons = document.querySelectorAll("nav button");
      const darkModeToggle = document.getElementById("darkModeToggle");
      const darkModeIcon = document.getElementById("darkModeIcon");

      let allCryptos = []; // Armazena dados de criptos para busca e simulador

      // --- Gerenciamento de Se√ß√µes e Dark Mode ---
      function showSection(sectionId) {
        sections.forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");

        navButtons.forEach((button) => {
          button.classList.remove("active");
          if (button.dataset.section === sectionId) {
            button.classList.add("active");
          }
        });
        // Rolagem para o topo da se√ß√£o
        document
          .getElementById(sectionId)
          .scrollIntoView({ behavior: "smooth", block: "start" });
      }

      navButtons.forEach((button) => {
        button.addEventListener("click", () =>
          showSection(button.dataset.section)
        );
      });

      // Dark Mode
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        const isDarkMode = document.body.classList.contains("dark-mode");
        localStorage.setItem("darkMode", isDarkMode);
        darkModeIcon.textContent = isDarkMode ? "üåô" : "‚òÄÔ∏è";
      }

      darkModeToggle.addEventListener("click", toggleDarkMode);

      // Carregar prefer√™ncia de Dark Mode
      if (localStorage.getItem("darkMode") === "true") {
        document.body.classList.add("dark-mode");
        darkModeIcon.textContent = "üåô";
      }

      // --- Fun√ß√µes Auxiliares Comuns ---
      function showMessage(element, text, type = "info") {
        element.textContent = text;
        element.className = `message ${type}`; // Corre√ß√£o aqui
        element.style.display = "block";
      }

      function hideMessage(element) {
        element.style.display = "none";
      }

      function formatCurrency(value, currency = "USD") {
        // Verifica se o valor √© num√©rico e finito
        if (typeof value !== "number" || !isFinite(value)) {
          return "N/A";
        }
        return value.toLocaleString("pt-BR", {
          // Alterado para pt-BR para formata√ß√£o local
          style: "currency",
          currency: currency,
          minimumFractionDigits: 2,
          maximumFractionDigits:
            currency === "BRL" || currency === "EUR" ? 2 : 8,
        });
      }

      // --- Sparkline (Mini-Gr√°ficos) ---
      // Certifique-se de que Chart.js esteja carregado antes desta fun√ß√£o
      function createSparkline(canvasId, data, color) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
          console.warn(`Canvas with ID ${canvasId} not found.`);
          return null;
        }
        const ctx = canvas.getContext("2d");

        // Destruir gr√°fico existente se houver
        if (Chart.getChart(canvasId)) {
          Chart.getChart(canvasId).destroy();
        }

        const sparklineChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.map((_, i) => i), // √çndices como labels
            datasets: [
              {
                data: data,
                borderColor: color,
                borderWidth: 1.5,
                fill: false,
                pointRadius: 0,
                tension: 0.1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { enabled: false },
            },
            scales: {
              x: { display: false },
              y: { display: false },
            },
            layout: {
              padding: {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });
        return sparklineChart;
      }

      // --- Dashboard Essencial ---
      const top5Dashboard = document.getElementById("top5Dashboard");
      const dashboardLoadingMessage = document.getElementById(
        "dashboardLoadingMessage"
      );
      const volatilityThermo = document.getElementById("volatilityThermo");
      const volatilityLevel = document.getElementById("volatilityLevel");

      async function fetchDashboardData() {
        showMessage(
          dashboardLoadingMessage,
          "Carregando os principais dados do mercado...",
          "info"
        );
        try {
          // Buscando dados das 5 principais criptomoedas com sparkline de 7 dias
          const response = await fetch(
            `${COINGECKO_API_URL}/coins/markets?vs_currency=brl&order=market_cap_desc&per_page=5&page=1&sparkline=true&price_change_percentage=24h`
          );
          if (!response.ok)
            throw new Error("Falha ao buscar dados do dashboard.");
          const data = await response.json();

          top5Dashboard.innerHTML = ""; // Limpa o conte√∫do anterior
          let totalVolatility = 0;

          data.forEach((crypto) => {
            const priceChange24h = crypto.price_change_percentage_24h
              ? crypto.price_change_percentage_24h.toFixed(2)
              : "N/A";
            const changeClass =
              priceChange24h > 0
                ? "positive"
                : priceChange24h < 0
                ? "negative"
                : "";
            const color =
              priceChange24h > 0
                ? varStyle("--cor-sucesso")
                : varStyle("--cor-erro");
            totalVolatility += Math.abs(parseFloat(priceChange24h) || 0); // Garante que √© um n√∫mero

            const card = document.createElement("div");
            card.classList.add("dashboard-card");
            card.innerHTML = `
                        <img src="${crypto.image}" alt="${crypto.name}">
                        <h3>${crypto.name} (${crypto.symbol.toUpperCase()})</h3>
                        <p>${formatCurrency(crypto.current_price, "BRL")}</p>
                        <span class="change ${changeClass}">${priceChange24h}% (24h)</span>
                        <canvas id="sparkline-${
                          crypto.id
                        }" class="sparkline-canvas"></canvas>
                    `;
            top5Dashboard.appendChild(card);

            // Renderiza o sparkline
            // A API do CoinGecko retorna sparkline_in_7d.price, que geralmente tem 168 pontos (7 dias * 24h)
            // Para 24h, pegamos os √∫ltimos 24 pontos.
            if (
              crypto.sparkline_in_7d &&
              crypto.sparkline_in_7d.price &&
              crypto.sparkline_in_7d.price.length > 0
            ) {
              const sparklineData = crypto.sparkline_in_7d.price.slice(-24); // Pega as √∫ltimas 24 horas (aproximado)
              createSparkline(`sparkline-${crypto.id}`, sparklineData, color);
            }
          });

          // Calcula e exibe a volatilidade geral
          const avgVolatility =
            data.length > 0 ? totalVolatility / data.length : 0;
          let volatilityText = "Baixa";
          let volatilityClass = "low";
          if (avgVolatility > 5) {
            volatilityText = "Alta";
            volatilityClass = "high";
          } else if (avgVolatility > 2) {
            volatilityText = "M√©dia";
            volatilityClass = "medium";
          }
          volatilityLevel.textContent = volatilityText;
          volatilityThermo.className = `volatility-thermometer ${volatilityClass}`; // Corre√ß√£o aqui

          hideMessage(dashboardLoadingMessage);
        } catch (error) {
          console.error("Erro ao buscar dados do dashboard:", error);
          showMessage(
            dashboardLoadingMessage,
            "Erro ao carregar dashboard. Tente novamente mais tarde.",
            "error"
          );
        }
      }

      // Helper para pegar valor de vari√°vel CSS
      function varStyle(name) {
        return getComputedStyle(document.documentElement)
          .getPropertyValue(name)
          .trim(); // Adicionado .trim()
      }

      // --- Pre√ßos em Tempo Real e Ranking ---
      const cryptoTableBody = document.querySelector("#cryptoTable tbody");
      const cryptoSearchInput = document.getElementById("cryptoSearch");
      const realtimeLoadingMessage = document.getElementById(
        "realtimeLoadingMessage"
      );
      let currentCryptoPrices = []; // Armazena dados para a tabela de ranking

      async function fetchCryptoPrices() {
        showMessage(
          realtimeLoadingMessage,
          "Carregando dados... Atualizando a cada minuto.",
          "info"
        );
        try {
          const response = await fetch(
            `${COINGECKO_API_URL}/coins/markets?vs_currency=brl&order=market_cap_desc&per_page=50&page=1&sparkline=true&price_change_percentage=24h`
          );
          if (!response.ok)
            throw new Error("Falha ao buscar pre√ßos das criptomoedas.");
          const data = await response.json();
          allCryptos = data; // Armazena para a busca global e simulador
          currentCryptoPrices = data; // Armazena para a tabela
          displayCryptoPrices(data);
          hideMessage(realtimeLoadingMessage);
        } catch (error) {
          console.error("Erro ao buscar pre√ßos:", error);
          showMessage(
            realtimeLoadingMessage,
            "Erro ao carregar dados. Tente novamente mais tarde.",
            "error"
          );
        }
      }

      function displayCryptoPrices(cryptos) {
        cryptoTableBody.innerHTML = ""; // Limpa a tabela
        cryptos.forEach((crypto, index) => {
          const row = cryptoTableBody.insertRow();
          const priceChange24h = crypto.price_change_percentage_24h
            ? crypto.price_change_percentage_24h.toFixed(2)
            : "N/A";
          const changeClass =
            priceChange24h > 0
              ? "positive"
              : priceChange24h < 0
              ? "negative"
              : "";
          const sparklineColor =
            priceChange24h > 0
              ? varStyle("--cor-sucesso")
              : varStyle("--cor-erro");

          const sparklineCanvasId = `sparkline-table-${crypto.id}`;
          row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><img src="${crypto.image}" alt="${
            crypto.name
          }" width="20" height="20" style="vertical-align: middle; margin-right: 5px;"> ${
            crypto.name
          } (${crypto.symbol.toUpperCase()})</td>
                    <td>${formatCurrency(crypto.current_price, "BRL")}</td>
                    <td class="${changeClass}">${priceChange24h}%</td>
                    <td><canvas id="${sparklineCanvasId}" class="sparkline-canvas"></canvas></td>
                    <td>${formatCurrency(crypto.market_cap, "BRL")}</td>
                `;

          // Renderiza o sparkline para cada linha da tabela
          if (
            crypto.sparkline_in_7d &&
            crypto.sparkline_in_7d.price &&
            crypto.sparkline_in_7d.price.length > 0
          ) {
            const sparklineData = crypto.sparkline_in_7d.price.slice(-24); // Pega as √∫ltimas 24 horas (aproximado)
            createSparkline(sparklineCanvasId, sparklineData, sparklineColor);
          }
        });
      }

      cryptoSearchInput.addEventListener("input", () => {
        const searchTerm = cryptoSearchInput.value.toLowerCase();
        const filteredCryptos = currentCryptoPrices.filter(
          (crypto) =>
            crypto.name.toLowerCase().includes(searchTerm) ||
            crypto.symbol.toLowerCase().includes(searchTerm)
        );
        displayCryptoPrices(filteredCryptos);
      });

      // --- Simulador de Lucro "E Se..." ---
      const calculateProfitBtn = document.getElementById("calculateProfitBtn");
      const simScenarioSelect = document.getElementById("simScenario");
      const customScenarioFields = document.getElementById(
        "customScenarioFields"
      );
      const simCryptoCustomSelect = document.getElementById("simCryptoCustom");
      const investedAmountCustomInput = document.getElementById(
        "investedAmountCustom"
      );
      const startDateCustomInput = document.getElementById("startDateCustom");
      const simulatorResult = document.getElementById("simulatorResult");
      const initialValueDisplay = document.getElementById(
        "initialValueDisplay"
      );
      const currentValueDisplay = document.getElementById(
        "currentValueDisplay"
      );
      const profitLossDisplay = document.getElementById("profitLossDisplay");
      const percentDisplay = document.getElementById("percentDisplay");
      const simulatorErrorMessage = document.getElementById(
        "simulatorErrorMessage"
      );

      // Define a data inicial padr√£o para 1 ano atr√°s para o cen√°rio custom
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
      startDateCustomInput.value = oneYearAgo.toISOString().split("T")[0];

      simScenarioSelect.addEventListener("change", () => {
        if (simScenarioSelect.value === "custom") {
          customScenarioFields.style.display = "block";
        } else {
          customScenarioFields.style.display = "none";
        }
        hideMessage(simulatorErrorMessage);
        simulatorResult.style.display = "none";
      });

      calculateProfitBtn.addEventListener("click", calculateSimulatorResult);

      async function calculateSimulatorResult() {
        hideMessage(simulatorErrorMessage);
        simulatorResult.style.display = "none";

        let cryptoId, investedAmount, startDate;
        const scenario = simScenarioSelect.value;

        if (scenario === "custom") {
          cryptoId = simCryptoCustomSelect.value;
          investedAmount = parseFloat(investedAmountCustomInput.value);
          startDate = startDateCustomInput.value;

          if (
            !cryptoId ||
            isNaN(investedAmount) ||
            investedAmount <= 0 ||
            !startDate
          ) {
            showMessage(
              simulatorErrorMessage,
              "Por favor, preencha todos os campos para o cen√°rio personalizado.",
              "error"
            );
            return;
          }

          // Valida√ß√£o da data: n√£o pode ser futura e n√£o muito antiga (ex: antes de 2010 para cripto)
          const selectedDate = new Date(startDate);
          const today = new Date();
          today.setHours(0, 0, 0, 0); // Zera a hora para compara√ß√£o de datas

          if (selectedDate > today) {
            showMessage(
              simulatorErrorMessage,
              "A data inicial n√£o pode ser futura.",
              "error"
            );
            return;
          }

          // Coingecko historical data goes back to Bitcoin's inception (2010s)
          const minValidDate = new Date("2010-01-01");
          if (selectedDate < minValidDate) {
            showMessage(
              simulatorErrorMessage,
              "A data √© muito antiga. Por favor, escolha uma data ap√≥s 2010.",
              "error"
            );
            return;
          }
        } else {
          const [id, time, amount] = scenario.split("-");
          cryptoId = id;
          investedAmount = parseFloat(amount);

          // Calcular startDate baseado no cen√°rio pr√©-definido
          const date = new Date();
          if (time === "1y") date.setFullYear(date.getFullYear() - 1);
          else if (time === "6m") date.setMonth(date.getMonth() - 6);
          else if (time === "3m") date.setMonth(date.getMonth() - 3);
          else if (time === "1m") date.setMonth(date.getMonth() - 1);
          startDate = date.toISOString().split("T")[0];
        }

        try {
          // Obter pre√ßo hist√≥rico
          const historyResponse = await fetch(
            `${COINGECKO_API_URL}/coins/${cryptoId}/history?date=${formatDateForCoinGecko(
              startDate
            )}`
          );
          if (!historyResponse.ok)
            throw new Error("Falha ao buscar pre√ßo hist√≥rico.");
          const historyData = await historyResponse.json();

          if (
            !historyData.market_data ||
            !historyData.market_data.current_price ||
            !historyData.market_data.current_price.brl
          ) {
            showMessage(
              simulatorErrorMessage,
              "Dados hist√≥ricos n√£o dispon√≠veis para esta data ou criptomoeda.",
              "error"
            );
            return;
          }
          const historicalPriceBRL = historyData.market_data.current_price.brl;

          // Obter pre√ßo atual
          const currentPriceResponse = await fetch(
            `${COINGECKO_API_URL}/simple/price?ids=${cryptoId}&vs_currencies=brl`
          );
          if (!currentPriceResponse.ok)
            throw new Error("Falha ao buscar pre√ßo atual.");
          const currentPriceData = await currentPriceResponse.json();
          const currentPriceBRL = currentPriceData[cryptoId]
            ? currentPriceData[cryptoId].brl
            : null;

          if (!currentPriceBRL) {
            showMessage(
              simulatorErrorMessage,
              "N√£o foi poss√≠vel obter o pre√ßo atual da criptomoeda.",
              "error"
            );
            return;
          }

          const numberOfCoins = investedAmount / historicalPriceBRL;
          const currentValue = numberOfCoins * currentPriceBRL;
          const profitLoss = currentValue - investedAmount;
          const percentChange =
            ((currentValue - investedAmount) / investedAmount) * 100;

          initialValueDisplay.textContent = formatCurrency(
            investedAmount,
            "BRL"
          );
          currentValueDisplay.textContent = formatCurrency(currentValue, "BRL");
          profitLossDisplay.textContent = `${formatCurrency(
            profitLoss,
            "BRL"
          )}`;
          profitLossDisplay.className =
            profitLoss > 0 ? "positive" : profitLoss < 0 ? "negative" : "";
          percentDisplay.textContent = `${percentChange.toFixed(2)}%`;
          percentDisplay.className =
            percentChange > 0
              ? "positive"
              : percentChange < 0
              ? "negative"
              : "";

          simulatorResult.style.display = "block";
        } catch (error) {
          console.error("Erro no simulador:", error);
          showMessage(
            simulatorErrorMessage,
            `Erro ao calcular resultado: ${error.message}. Verifique a data e tente novamente.`,
            "error"
          );
        }
      }

      // Formata a data para o formato dd-mm-yyyy que a CoinGecko API espera
      function formatDateForCoinGecko(dateString) {
        const [year, month, day] = dateString.split("-");
        return `${day}-${month}-${year}`;
      }

      // --- Conversor Inteligente ---
      const convertAmountInput = document.getElementById("convertAmount");
      const fromCurrencySelect = document.getElementById("fromCurrency");
      const toCurrencySelect = document.getElementById("toCurrency");
      const convertBtn = document.getElementById("convertBtn");
      const convertResult = document.getElementById("convertResult");
      const converterErrorMessage = document.getElementById(
        "converterErrorMessage"
      );
      const coffeeValueMessage = document.getElementById("coffeeValueMessage");

      convertBtn.addEventListener("click", convertCurrency);

      async function convertCurrency() {
        hideMessage(converterErrorMessage);
        convertResult.textContent = "Resultado: Calculando...";
        coffeeValueMessage.textContent = "Calculando...";

        const amount = parseFloat(convertAmountInput.value);
        const from = fromCurrencySelect.value;
        const to = toCurrencySelect.value;

        if (isNaN(amount) || amount <= 0) {
          showMessage(
            converterErrorMessage,
            "Por favor, insira uma quantia v√°lida.",
            "error"
          );
          return;
        }

        if (from === to) {
          convertResult.textContent = `Resultado: ${formatCurrency(
            amount,
            to.toUpperCase()
          )}`;
          calculateCoffeeValue(amount, to); // Calcula o caf√© mesmo se for a mesma moeda
          return;
        }

        try {
          // Obter pre√ßos de todas as moedas selecionadas em BRL ou USD
          let vs_currencies = new Set();
          if (from === "brl" || to === "brl") {
            vs_currencies.add("brl");
          }
          if (from === "usd" || to === "usd") {
            vs_currencies.add("usd");
          }
          if (from === "eur" || to === "eur") {
            vs_currencies.add("eur");
          }

          let cryptoIds = [];
          if (from !== "brl" && from !== "usd" && from !== "eur") {
            cryptoIds.push(
              allCryptos.find((c) => c.symbol === from)?.id || from
            );
          }
          if (to !== "brl" && to !== "usd" && to !== "eur") {
            cryptoIds.push(allCryptos.find((c) => c.symbol === to)?.id || to);
          }

          const idsParam = cryptoIds.join(",");
          const vsCurrenciesParam = [...vs_currencies].join(",");

          let prices = {};
          if (idsParam || vsCurrenciesParam) {
            const response = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=${idsParam}&vs_currencies=${
                vsCurrenciesParam || "usd"
              }`
            );
            if (!response.ok)
              throw new Error("Falha ao buscar taxas de c√¢mbio.");
            prices = await response.json();
          }

          // Handle fiat to fiat conversions (e.g., USD to BRL)
          // Use a CoinGecko para c√¢mbio de moedas fiduci√°rias se necess√°rio
          if (
            (from === "usd" && to === "brl") ||
            (from === "brl" && to === "usd")
          ) {
            const fiatResponse = await fetch(
              `https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd,brl`
            );
            const fiatData = await fiatResponse.json();
            const usdToBrlRate = fiatData.bitcoin.brl / fiatData.bitcoin.usd;

            if (from === "usd" && to === "brl") {
              const convertedValue = amount * usdToBrlRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "BRL"
              )}`;
              calculateCoffeeValue(convertedValue, "brl");
              return;
            } else if (from === "brl" && to === "usd") {
              const convertedValue = amount / usdToBrlRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "USD"
              )}`;
              calculateCoffeeValue(convertedValue, "usd");
              return;
            }
          }
          // Handle EUR conversions
          if (
            (from === "eur" && to === "brl") ||
            (from === "brl" && to === "eur")
          ) {
            const fiatResponse = await fetch(
              `https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur,brl`
            );
            const fiatData = await fiatResponse.json();
            const eurToBrlRate = fiatData.bitcoin.brl / fiatData.bitcoin.eur;

            if (from === "eur" && to === "brl") {
              const convertedValue = amount * eurToBrlRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "BRL"
              )}`;
              calculateCoffeeValue(convertedValue, "brl");
              return;
            } else if (from === "brl" && to === "eur") {
              const convertedValue = amount / eurToBrlRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "EUR"
              )}`;
              calculateCoffeeValue(convertedValue, "eur");
              return;
            }
          }
          if (
            (from === "eur" && to === "usd") ||
            (from === "usd" && to === "eur")
          ) {
            const fiatResponse = await fetch(
              `https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur,usd`
            );
            const fiatData = await fiatResponse.json();
            const eurToUsdRate = fiatData.bitcoin.usd / fiatData.bitcoin.eur;

            if (from === "eur" && to === "usd") {
              const convertedValue = amount * eurToUsdRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "USD"
              )}`;
              calculateCoffeeValue(convertedValue, "usd");
              return;
            } else if (from === "usd" && to === "eur") {
              const convertedValue = amount / eurToUsdRate;
              convertResult.textContent = `Resultado: ${formatCurrency(
                convertedValue,
                "EUR"
              )}`;
              calculateCoffeeValue(convertedValue, "eur");
              return;
            }
          }

          let fromPriceInBRL = 0;
          let toPriceInBRL = 0;

          // Determine price of 'from' currency in BRL
          if (from === "brl") {
            fromPriceInBRL = 1;
          } else if (from === "usd") {
            // Get USD to BRL rate
            const responseBRL = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=bitcoin&vs_currencies=brl,usd`
            );
            const dataBRL = await responseBRL.json();
            fromPriceInBRL = (1 / dataBRL.bitcoin.usd) * dataBRL.bitcoin.brl; // Price of 1 USD in BRL
          } else if (from === "eur") {
            const responseBRL = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=bitcoin&vs_currencies=brl,eur`
            );
            const dataBRL = await responseBRL.json();
            fromPriceInBRL = (1 / dataBRL.bitcoin.eur) * dataBRL.bitcoin.brl; // Price of 1 EUR in BRL
          } else {
            // Cryptocurrency
            const cryptoInfo = allCryptos.find((c) => c.symbol === from);
            if (!cryptoInfo)
              throw new Error(
                `Criptomoeda de origem '${from}' n√£o encontrada.`
              );
            fromPriceInBRL = cryptoInfo.current_price;
          }

          // Determine price of 'to' currency in BRL
          if (to === "brl") {
            toPriceInBRL = 1;
          } else if (to === "usd") {
            const responseBRL = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=bitcoin&vs_currencies=brl,usd`
            );
            const dataBRL = await responseBRL.json();
            toPriceInBRL = (1 / dataBRL.bitcoin.usd) * dataBRL.bitcoin.brl; // Price of 1 USD in BRL
          } else if (to === "eur") {
            const responseBRL = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=bitcoin&vs_currencies=brl,eur`
            );
            const dataBRL = await responseBRL.json();
            toPriceInBRL = (1 / dataBRL.bitcoin.eur) * dataBRL.bitcoin.brl; // Price of 1 EUR in BRL
          } else {
            // Cryptocurrency
            const cryptoInfo = allCryptos.find((c) => c.symbol === to);
            if (!cryptoInfo)
              throw new Error(`Criptomoeda de destino '${to}' n√£o encontrada.`);
            toPriceInBRL = cryptoInfo.current_price;
          }

          if (fromPriceInBRL === 0 || toPriceInBRL === 0) {
            throw new Error(
              "N√£o foi poss√≠vel obter uma das taxas de convers√£o."
            );
          }

          const convertedValue = (amount * fromPriceInBRL) / toPriceInBRL;
          convertResult.textContent = `Resultado: ${formatCurrency(
            convertedValue,
            to.toUpperCase()
          )}`;
          calculateCoffeeValue(convertedValue, to);
        } catch (error) {
          console.error("Erro no conversor:", error);
          showMessage(
            converterErrorMessage,
            `Erro ao converter: ${error.message}.`,
            "error"
          );
          convertResult.textContent = "Resultado: Erro";
          coffeeValueMessage.textContent = "Erro ao calcular.";
        }
      }

      async function calculateCoffeeValue(convertedAmount, targetCurrency) {
        // Pre√ßo m√©dio de um caf√© em BRL
        const coffeePriceBRL = 7.5; // Exemplo de pre√ßo em BRL

        try {
          let coffeeValueInTargetCurrency;

          if (targetCurrency === "brl") {
            coffeeValueInTargetCurrency = coffeePriceBRL;
          } else {
            // Converter o pre√ßo do caf√© para a moeda alvo
            const response = await fetch(
              `${COINGECKO_API_URL}/simple/price?ids=bitcoin&vs_currencies=brl,${targetCurrency}`
            );
            if (!response.ok)
              throw new Error("Falha ao buscar taxa para caf√©.");
            const data = await response.json();

            if (
              data.bitcoin &&
              data.bitcoin.brl &&
              data.bitcoin[targetCurrency]
            ) {
              const brlToTargetRate =
                data.bitcoin[targetCurrency] / data.bitcoin.brl;
              coffeeValueInTargetCurrency = coffeePriceBRL * brlToTargetRate;
            } else {
              throw new Error(
                `Dados de convers√£o para ${targetCurrency.toUpperCase()} n√£o dispon√≠veis.`
              );
            }
          }

          if (convertedAmount < coffeeValueInTargetCurrency) {
            coffeeValueMessage.textContent = `Seu valor equivale a menos de 1 caf√©.`;
          } else {
            const numberOfCoffees =
              convertedAmount / coffeeValueInTargetCurrency;
            coffeeValueMessage.textContent = `Seu valor equivale a aproximadamente ${numberOfCoffees.toFixed(
              2
            )} caf√©s!`;
          }
        } catch (error) {
          console.error("Erro ao calcular valor do caf√©:", error);
          coffeeValueMessage.textContent = "Erro ao calcular o valor do caf√©.";
        }
      }

      // --- An√°lise de Sentimento ---
      const sentimentGauge = document.getElementById("sentimentGauge");
      const sentimentDescription = document.getElementById(
        "sentimentDescription"
      );
      const sentimentButtons = document.querySelectorAll(".sentiment-btn");
      const surveyFeedback = document.getElementById("surveyFeedback");

      async function calculateMarketSentiment() {
        sentimentGauge.textContent = "--";
        sentimentDescription.textContent = "Calculando o humor do mercado...";
        try {
          // Fetch top 10 cryptos by market cap to calculate an average sentiment
          const response = await fetch(
            `${COINGECKO_API_URL}/coins/markets?vs_currency=brl&order=market_cap_desc&per_page=10&page=1&price_change_percentage=24h`
          );
          if (!response.ok)
            throw new Error("Falha ao buscar dados para sentimento.");
          const data = await response.json();

          let totalChange = 0;
          let count = 0;
          data.forEach((crypto) => {
            if (crypto.price_change_percentage_24h !== null) {
              totalChange += crypto.price_change_percentage_24h;
              count++;
            }
          });

          if (count === 0) {
            sentimentGauge.textContent = "N/A";
            sentimentDescription.textContent =
              "N√£o foi poss√≠vel calcular o sentimento no momento.";
            return;
          }

          const averageChange = totalChange / count;

          let gaugeText = "";
          let description = "";
          let colorClass = "";

          if (averageChange > 3) {
            gaugeText = "üöÄ Otimista";
            description =
              "O mercado est√° em alta, com forte movimento positivo nas √∫ltimas 24h.";
            colorClass = "positive";
          } else if (averageChange >= 0.5) {
            gaugeText = "üìà Levemente Otimista";
            description =
              "Pequenos ganhos dominam, indicando um sentimento positivo moderado.";
            colorClass = "positive";
          } else if (averageChange > -0.5) {
            gaugeText = "ü§î Neutro";
            description =
              "Mercado est√°vel, sem grandes movimentos. Cautela prevalece.";
            colorClass = ""; // Default text color
          } else if (averageChange <= -3) {
            gaugeText = "üìâ Pessimista";
            description =
              "Quedas significativas, o sentimento geral √© de baixa.";
            colorClass = "negative";
          } else {
            gaugeText = "üîª Levemente Pessimista";
            description =
              "Pequenas perdas, mas o mercado ainda pode se recuperar.";
            colorClass = "negative";
          }

          sentimentGauge.textContent = gaugeText;
          sentimentGauge.className = colorClass; // Add class for color if needed
          sentimentDescription.textContent = description;
        } catch (error) {
          console.error("Erro ao calcular sentimento de mercado:", error);
          sentimentGauge.textContent = "Erro";
          sentimentDescription.textContent =
            "Erro ao carregar an√°lise de sentimento.";
        }
      }

      sentimentButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
          const userSentiment = event.target.dataset.sentiment;
          let message = "";
          if (userSentiment === "optimistic") {
            message = "√ìtimo! Otimismo √© a chave para o longo prazo. üöÄ";
          } else if (userSentiment === "neutral") {
            message = "Entendido! Cautela √© prud√™ncia. ü§î";
          } else if (userSentiment === "pessimistic") {
            message = "Compreendemos. Mercados vol√°teis exigem aten√ß√£o. üìâ";
          }
          showMessage(surveyFeedback, message, "info");
          // Em um sistema real, voc√™ enviaria este dado para um backend.
        });
      });

      // --- Minuto Cripto: P√≠lulas de Conhecimento e Quiz ---
      const glossarySearchInput = document.getElementById("glossarySearch");
      const cryptoGlossaryDiv = document.getElementById("cryptoGlossary");
      const quizContainer = document.getElementById("quizContainer");
      const startQuizBtn = document.getElementById("startQuizBtn");
      const quizQuestionDiv = document.getElementById("quizQuestion");
      const quizResultPara = document.getElementById("quizResult");

      const glossaryItems = [
        {
          term: "Blockchain",
          definition:
            "Uma tecnologia de registro distribu√≠do e descentralizado que garante a seguran√ßa e imutabilidade das transa√ß√µes de criptomoedas.",
        },
        {
          term: "Bitcoin (BTC)",
          definition:
            "A primeira e mais famosa criptomoeda, criada para ser um sistema de dinheiro eletr√¥nico peer-to-peer descentralizado.",
        },
        {
          term: "Ethereum (ETH)",
          definition:
            "Uma plataforma descentralizada que permite a cria√ß√£o e execu√ß√£o de contratos inteligentes e aplicativos descentralizados (dApps).",
        },
        {
          term: "Altcoin",
          definition:
            'Qualquer criptomoeda que n√£o seja o Bitcoin. O termo "altcoin" significa "alternative coin" (moeda alternativa).',
        },
        {
          term: "Smart Contract (Contrato Inteligente)",
          definition:
            "Contratos autoexecut√°veis com os termos do acordo escritos diretamente em c√≥digo. Eles rodam em uma blockchain e s√£o imut√°veis.",
        },
        {
          term: "NFT (Token N√£o Fung√≠vel)",
          definition:
            "Um tipo de token criptogr√°fico que representa um ativo digital √∫nico e insubstitu√≠vel, como arte, m√∫sica ou itens de jogos.",
        },
        {
          term: "Halving",
          definition:
            "Um evento programado no Bitcoin (e algumas outras criptos) que reduz pela metade a recompensa que os mineradores recebem, impactando a oferta e escassez da moeda.",
        },
        {
          term: "Proof of Work (PoW)",
          definition:
            "Mecanismo de consenso usado por blockchains como Bitcoin, onde mineradores competem para resolver quebra-cabe√ßas complexos para validar transa√ß√µes.",
        },
        {
          term: "Proof of Stake (PoS)",
          definition:
            'Mecanismo de consenso onde os validadores s√£o escolhidos com base na quantidade de criptomoedas que eles "apostam" (stake) na rede.',
        },
        {
          term: "DeFi (Finan√ßas Descentralizadas)",
          definition:
            "Um ecossistema de aplicativos financeiros constru√≠dos em blockchains, visando replicar servi√ßos financeiros tradicionais sem intermedi√°rios.",
        },
      ];

      function displayGlossary(searchTerm = "") {
        cryptoGlossaryDiv.innerHTML = "";
        const filteredItems = glossaryItems.filter(
          (item) =>
            item.term.toLowerCase().includes(searchTerm.toLowerCase()) ||
            item.definition.toLowerCase().includes(searchTerm.toLowerCase())
        );

        if (filteredItems.length === 0) {
          cryptoGlossaryDiv.innerHTML =
            '<p class="message warning">Nenhum termo encontrado. Tente outra busca.</p>';
          return;
        }

        filteredItems.forEach((item) => {
          const div = document.createElement("div");
          div.classList.add("news-item");
          div.innerHTML = `<h3>${item.term}</h3><p>${item.definition}</p>`;
          cryptoGlossaryDiv.appendChild(div);
        });
      }

      glossarySearchInput.addEventListener("input", (event) => {
        displayGlossary(event.target.value);
      });

      // Initialize glossary display
      displayGlossary();

      // Quiz Logic
      const quizQuestions = [
        {
          question: "Qual o principal objetivo da tecnologia Blockchain?",
          options: [
            { text: "Criar redes sociais descentralizadas", correct: false },
            {
              text: "Garantir a seguran√ßa e imutabilidade de transa√ß√µes digitais",
              correct: true,
            },
            { text: "Acelerar o envio de e-mails", correct: false },
          ],
          profile: "seguran√ßa",
        },
        {
          question: "O que significa 'Halving' no contexto do Bitcoin?",
          options: [
            { text: "Uma nova criptomoeda √© lan√ßada", correct: false },
            {
              text: "A recompensa dos mineradores por bloco √© reduzida pela metade",
              correct: true,
            },
            { text: "O pre√ßo do Bitcoin duplica em 24h", correct: false },
          ],
          profile: "conhecimento",
        },
        {
          question: "Um 'Smart Contract' √©:",
          options: [
            { text: "Um contrato legal assinado digitalmente", correct: false },
            {
              text: "Um contrato autoexecut√°vel com termos em c√≥digo na blockchain",
              correct: true,
            },
            { text: "Um tipo de carteira de criptomoedas", correct: false },
          ],
          profile: "inova√ß√£o",
        },
      ];

      let currentQuestionIndex = 0;
      let userQuizScores = { seguran√ßa: 0, conhecimento: 0, inova√ß√£o: 0 };

      function startQuiz() {
        currentQuestionIndex = 0;
        userQuizScores = { seguran√ßa: 0, conhecimento: 0, inova√ß√£o: 0 };
        quizResultPara.textContent = "";
        startQuizBtn.style.display = "none";
        quizQuestionDiv.style.display = "block";
        loadQuestion();
      }

      function loadQuestion() {
        if (currentQuestionIndex < quizQuestions.length) {
          const questionData = quizQuestions[currentQuestionIndex];
          quizQuestionDiv.querySelector(
            "p:first-child"
          ).textContent = `Quest√£o ${currentQuestionIndex + 1} de ${
            quizQuestions.length
          }:`;
          quizQuestionDiv.querySelector(".question-text").textContent =
            questionData.question;
          const optionButtons =
            quizQuestionDiv.querySelectorAll(".quiz-option-btn");

          optionButtons.forEach((button, index) => {
            button.textContent = questionData.options[index].text;
            button.onclick = () =>
              selectAnswer(
                questionData.options[index].correct,
                questionData.profile
              );
            button.classList.remove("correct", "incorrect"); // Limpa estilos de resposta anterior
          });
        } else {
          showQuizResult();
        }
      }

      function selectAnswer(isCorrect, profileType) {
        if (isCorrect) {
          userQuizScores[profileType]++;
        }
        currentQuestionIndex++;
        loadQuestion();
      }

      function showQuizResult() {
        quizQuestionDiv.style.display = "none";
        startQuizBtn.style.display = "block";

        let maxScore = 0;
        let dominantProfile = "Neutro";

        for (const profile in userQuizScores) {
          if (userQuizScores[profile] > maxScore) {
            maxScore = userQuizScores[profile];
            dominantProfile = profile;
          } else if (userQuizScores[profile] === maxScore && maxScore > 0) {
            dominantProfile = "Misto"; // Se houver empate em mais de um com pontua√ß√£o > 0
          }
        }

        let resultText = "";
        if (maxScore === 0) {
          resultText =
            'Seu perfil cripto √© **Iniciante**. Explore mais o "Minuto Cripto" para aprender o b√°sico!';
        } else if (dominantProfile === "seguran√ßa") {
          resultText =
            "Seu perfil cripto √© **Focado em Seguran√ßa**. Voc√™ valoriza a robustez e a imutabilidade da tecnologia.";
        } else if (dominantProfile === "conhecimento") {
          resultText =
            "Seu perfil cripto √© **Curioso e Sedento por Conhecimento**. Voc√™ busca entender os fundamentos e a din√¢mica do mercado.";
        } else if (dominantProfile === "inova√ß√£o") {
          resultText =
            "Seu perfil cripto √© **Entusiasta da Inova√ß√£o**. Voc√™ se interessa pelas novas aplica√ß√µes e possibilidades das criptos.";
        } else {
          // Misto
          resultText =
            "Seu perfil cripto √© **Vers√°til**. Voc√™ tem um bom entendimento em diversas √°reas das criptomoedas.";
        }

        showMessage(
          quizResultPara,
          `**Resultado do Quiz:** ${resultText}`,
          "success"
        );
      }

      startQuizBtn.addEventListener("click", startQuiz);

      // --- Inicializa√ß√£o da p√°gina ---
      document.addEventListener("DOMContentLoaded", () => {
        fetchDashboardData();
        fetchCryptoPrices();
        calculateMarketSentiment();
        displayGlossary(); // Garante que o gloss√°rio esteja vis√≠vel ao carregar
      });

      // Atualizar dados a cada X minutos (ex: 5 minutos = 300000 ms)
      setInterval(fetchDashboardData, 300000);
      setInterval(fetchCryptoPrices, 300000);
      setInterval(calculateMarketSentiment, 300000);
    </script>
  </body>
</html>
