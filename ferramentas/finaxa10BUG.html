<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div
      id="finaxa-ebitda"
      style="
        font-family: Inter, sans-serif;
        max-width: 900px;
        margin: auto;
        background: #f4f7fb;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
      "
    >
      <div
        style="
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 16px;
        "
      >
        <div
          style="
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #4fc3f7, #0288d1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
          "
        >
          EB
        </div>
        <div>
          <h2 style="margin: 0">Calculadora de EBITDA</h2>
          <p style="margin: 2px 0 0; color: #6b7280">
            Calcule EBITDA, EBIT e margens de forma profissional e visualize em
            gráfico.
          </p>
        </div>
      </div>

      <form
        id="ebitdaForm"
        onsubmit="return false;"
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
          gap: 12px;
        "
      >
        <div>
          <label>Lucro Líquido (R$)</label
          ><input
            id="lucro"
            type="number"
            step="0.01"
            value="200000"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
        <div>
          <label>Receita Líquida (R$)</label
          ><input
            id="receita"
            type="number"
            step="0.01"
            placeholder="(opcional)"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
        <div>
          <label>Juros (R$)</label
          ><input
            id="juros"
            type="number"
            step="0.01"
            value="50000"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
        <div>
          <label>Impostos (R$)</label
          ><input
            id="impostos"
            type="number"
            step="0.01"
            value="30000"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
        <div>
          <label>Depreciação (R$)</label
          ><input
            id="depre"
            type="number"
            step="0.01"
            value="20000"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
        <div>
          <label>Amortização (R$)</label
          ><input
            id="amort"
            type="number"
            step="0.01"
            value="10000"
            style="
              width: 100%;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #ccc;
            "
          />
        </div>
      </form>

      <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px">
        <button
          id="calcBtn"
          style="
            background: linear-gradient(90deg, #4fc3f7, #0288d1);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
          "
        >
          Calcular
        </button>
        <button
          id="resetBtn"
          style="
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
          "
        >
          Limpar
        </button>
      </div>

      <div
        style="
          background: #fff;
          margin-top: 20px;
          padding: 16px;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        "
      >
        <div
          style="display: flex; justify-content: space-between; padding: 6px 0"
        >
          <span>EBITDA:</span><strong id="ebitdaVal">R$ 0,00</strong>
        </div>
        <div
          style="display: flex; justify-content: space-between; padding: 6px 0"
        >
          <span>EBIT:</span><strong id="ebitVal">R$ 0,00</strong>
        </div>
        <div
          style="display: flex; justify-content: space-between; padding: 6px 0"
        >
          <span>Margem EBITDA:</span><strong id="margemVal">—</strong>
        </div>
        <div
          style="display: flex; justify-content: space-between; padding: 6px 0"
        >
          <span>Margem EBIT:</span><strong id="margemEbitVal">—</strong>
        </div>
        <canvas id="compChart" height="180"></canvas>
      </div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      const fmtBR = (v) =>
        (Number(v) || 0).toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
        });

      function calcular() {
        const lucro = +$("lucro").value || 0,
          juros = +$("juros").value || 0,
          impostos = +$("impostos").value || 0,
          depre = +$("depre").value || 0,
          amort = +$("amort").value || 0,
          receita = +$("receita").value || 0;

        const ebitda = lucro + juros + impostos + depre + amort;
        const ebit = lucro + juros + impostos;
        const margemEbitda = receita ? (ebitda / receita) * 100 : null;
        const margemEbit = receita ? (ebit / receita) * 100 : null;

        $("ebitdaVal").textContent = fmtBR(ebitda);
        $("ebitVal").textContent = fmtBR(ebit);
        $("margemVal").textContent = margemEbitda
          ? margemEbitda.toFixed(2) + " %"
          : "—";
        $("margemEbitVal").textContent = margemEbit
          ? margemEbit.toFixed(2) + " %"
          : "—";

        if (window.compChart) {
          window.compChart.data.datasets[0].data = [
            lucro,
            juros,
            impostos,
            depre,
            amort,
          ];
          window.compChart.update();
        }
      }

      document.addEventListener("click", (e) => {
        if (e.target.id === "calcBtn") {
          calcular();
        }
        if (e.target.id === "resetBtn") {
          document.getElementById("ebitdaForm").reset();
          $("ebitdaVal").textContent = "R$ 0,00";
          $("ebitVal").textContent = "R$ 0,00";
          $("margemVal").textContent = "—";
          $("margemEbitVal").textContent = "—";
        }
      });

      (async () => {
        const s = document.createElement("script");
        s.src = "https://cdn.jsdelivr.net/npm/chart.js";
        s.onload = () => {
          const ctx = $("compChart").getContext("2d");
          window.compChart = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: [
                "Lucro Líquido",
                "Juros",
                "Impostos",
                "Depreciação",
                "Amortização",
              ],
              datasets: [
                {
                  data: [200000, 50000, 30000, 20000, 10000],
                  backgroundColor: [
                    "#4fc3f7",
                    "#0288d1",
                    "#81c784",
                    "#ffb74d",
                    "#4db6ac",
                  ],
                },
              ],
            },
            options: {
              plugins: { legend: { position: "bottom" } },
              maintainAspectRatio: false,
            },
          });
          calcular();
        };
        document.head.appendChild(s);
      })();
    </script>
  </body>
</html>
